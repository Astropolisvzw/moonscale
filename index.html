<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Gravity Simulator</title>
        <link rel="stylesheet" href="styles.css"/>
    </head>
    <body>
        <div class="bg">
            <div class="sidebar"></div>
            <div class="textbox">
                <div class="planet-label">MARS</div>
                <div class="maintext">LOADING...</div>
            </div>
        <script>
            function connect() {
                var ws = new WebSocket("ws://127.0.0.1:5678/");
                console.log("Connecting websocket")
                ws.onmessage = function (event) {
                    var obj = JSON.parse(event.data);

                    // Update Mars weight in center
                    document.getElementsByClassName('maintext')[0].innerHTML = obj['Mars'] + ' kg';

                    // Update sidebar with all other planets
                    var sidebar = document.getElementsByClassName('sidebar')[0];
                    var html = '';
                    for (var planet in obj) {
                        if (planet !== 'Mars') {
                            var weight = obj[planet];
                            var weightDisplay = weight + ' kg';
                            var itemClass = 'planet-item';
                            var icon = '';

                            // Special formatting for extreme values
                            if (planet === 'ISS') {
                                weightDisplay = 'WEIGHTLESS';
                                itemClass += ' zero-g';
                                icon = 'üõ∞Ô∏è ';
                            } else if (planet === 'Neutron Star' || planet === 'White Dwarf') {
                                // Use scientific notation for extreme gravity
                                if (weight > 1000000) {
                                    var exponent = Math.floor(Math.log10(weight));
                                    var mantissa = (weight / Math.pow(10, exponent)).toFixed(1);
                                    weightDisplay = mantissa + '√ó10<sup>' + exponent + '</sup> kg';
                                }
                                itemClass += ' extreme-gravity';
                                icon = '‚≠ê ';
                            } else if (planet === 'Sun') {
                                itemClass += ' extreme-gravity';
                                icon = '‚òÄÔ∏è ';
                            } else if (planet === 'Olympus Mons') {
                                icon = 'üåã ';
                            } else if (weight < 0.1 * obj['Earth']) {
                                itemClass += ' low-gravity';
                            }

                            html += '<div class="' + itemClass + '">';
                            html += '<span class="planet-name">' + icon + planet + '</span>';
                            html += '<span class="planet-weight">' + weightDisplay + '</span>';
                            html += '</div>';
                        }
                    }
                    sidebar.innerHTML = html;

		    console.log("receiving data: " + JSON.stringify(obj))
                };

                ws.onclose = function(e) {
                    console.log('socket closed try again');
                    setTimeout(function() {
                          connect();
                        }, 1000);
                }

                ws.onerror = function(err) {
                    console.error(err)
                };
            };
            connect();

            // Make MARS label shake every 30 seconds
            setInterval(function() {
                var label = document.getElementsByClassName('planet-label')[0];
                label.classList.add('shake');
                setTimeout(function() {
                    label.classList.remove('shake');
                }, 500);
            }, 30000);
        </script>
        </div>
    </body>
</html>
